var GOINVOKE={t:null,i:null,o:null,h:null,l:0,u:null,m:{prompt:{open:!0,_:document.getElementById("prompt")},p:{open:!0,_:document.getElementById("generation")},g:{open:!0,_:document.getElementById("image")},v:{open:!0,_:document.getElementById("server")}},k:{q:"ddim",S:"ddpm",I:"deis",O:"lms",T:"lms_k",N:"pndm",$:"heun",M:"heun_k",D:"euler",J:"euler_k",P:"euler_a",B:"kdpm_2",G:"kdpm_2_a",L:"dpmpp_2s",U:"dpmpp_2s_k",A:"dpmpp_2m",C:"dpmpp_2m_k",F:"dpmpp_2m_sde",H:"dpmpp_2m_sde_k",K:"dpmpp_sde",R:"dpmpp_sde_k",V:"unipc",j:"lcm"},X:{address:document.getElementById("address"),W:document.getElementById("model"),Y:document.getElementById("positive_prompt"),Z:document.getElementById("negative_prompt"),ee:document.getElementById("steps"),te:document.getElementById("cfg_scale"),height:document.getElementById("height"),width:document.getElementById("width"),ie:document.getElementById("queue_size"),seed:document.getElementById("seed"),random:document.getElementById("random"),se:document.getElementById("percent-bar"),ne:document.getElementById("generate"),cancel:document.getElementById("cancel"),clear:document.getElementById("clear"),oe:document.getElementById("scheduler"),de:document.getElementById("output"),error:document.getElementById("error"),ae:document.getElementById("results-gallery"),username:document.getElementById("username"),password:document.getElementById("password"),connect:document.getElementById("connect"),he:document.getElementById("shuffle")},ce:{le:"default",random:"true",ie:1,address:null,oe:"euler_a",re:null,ee:20,te:7.5,height:512,width:512,seed:0,username:"",ue:"",Y:"a painting of a cat",Z:"cartoon, painting, illustration, (worst quality, low quality, normal quality:2), too many limbs, bad anatomy"},init:function(){for(var e in this.k){var t=document.createElement("option");t.value=this.k[e],t.innerHTML=this.k[e],this.X.oe.appendChild(t)}this.X.connect.onclick=()=>{this.connect()},this.X.he.onclick=()=>{this.me()},this.X.ne.onclick=()=>{this._e()},this.X.cancel.onclick=()=>{this.pe()},this.X.clear.onclick=()=>{this.ge()};for(let t in this.ce){let e=document.getElementById(t);if(this.ce[t]=this.fe(t)||this.ce[t],console.log(t,this.ce[t]),e)switch(e.type){case"text":case"textarea":e.value=this.ce[t],e.onkeyup=()=>{this.ve({id:t,value:e.value})};break;case"checkbox":e.checked="true"==this.ce[t],"random"==t&&(this.X.seed.disabled=e.checked),e.onchange=()=>{this.ve({id:t,value:e.checked}),"random"==t&&(this.X.seed.disabled=e.checked)};break;default:e.value=this.ce[t],e.onchange=()=>{this.ve({id:t,value:e.value})}}}this.ce.address&&this.ke();for(let e in this.m){var i=this.m[e];i.open="true"==this.fe(e),i._.open=i.open,i._.querySelector("summary").onclick=()=>{this.be(e)}}for(let i of document.querySelectorAll(".spinner-button")){let e=i.getAttribute("data-target"),t=i.getAttribute("data-action");i.onclick=()=>{"increment"==t?this.stepUp(i,e):"decrement"==t&&this.stepDown(i,e)}}},connect:function(){var e=this.X.address.value,t=this.X.username.value,i=this.X.password.value,e=e+"/api/v1/app/version",s=new XMLHttpRequest;s.open("GET",e,!0),s.setRequestHeader("Authorization","Basic "+btoa(t+":"+i)),s.onreadystatechange=function(){4===s.readyState&&(200===s.status?(this.ke(),this.X.password.style.border="1px solid var(--ok-color)",this.ce.ue=btoa(t+":"+i),this.ve({id:"basic_auth",value:this.ce.ue})):(this.ye("Invalid credentials"),this.X.password.style.border="1px solid var(--error-color)"))}.bind(this),s.send()},ye:function(e){this.X.error.innerHTML=e,this.X.error.style.display="block",setTimeout(()=>{this.X.error.style.display="none"},5e3)},ke:function(){this.qe(),this.we()},be:function(e){var t=this.m[e];t.open=!t.open,this.ve({id:e,value:t.open})},fe:function(e){return localStorage.getItem(e)||""},ve:function(e){"checkbox"===e.type?(this.ce[e.id]=e.checked?"true":"false",localStorage.setItem(e.id,e.checked?"true":"false")):(this.ce[e.id]=e.value,localStorage.setItem(e.id,e.value)),"address"==e.id&&setTimeout(()=>{this.ke()},1e3),"random"==e.id&&(this.X.seed.disabled=e.checked,e.checked||(this.ve({id:"queue_size",value:1}),this.X.ie.value=1))},me:function(){try{var e=Math.floor(1e9*Math.random());this.X.seed.value=e,this.ve({id:"seed",value:this.X.seed.value})}catch(e){this.ye(e)}},stepUp:function(e,t){t=document.getElementById(t);t.stepUp(),this.ve(t)},stepDown:function(e,t){t=document.getElementById(t);t.stepDown(),this.ve(t)},Se:function(){return this.X.address.value},Ie:function(){var e={Oe:"application/json"};return this.ce.ue&&(e.Te="Basic "+this.ce.ue),e},pe:function(){this.X.cancel.disabled=!0,this.X.clear.disabled=!0,fetch(`${this.Se()}/api/v1/queue/${this.ce.le}/i/${this.i}/cancel`,{method:"PUT",headers:this.Ie()}).then(e=>{e.ok&&(console.log("Generation cancelled"),this.X.cancel.disabled=!1,this.X.clear.disabled=!1,this.X.se.style.width="0%",this.X.de.src="")})},ge:function(){this.X.cancel.disabled=!0,this.X.clear.disabled=!0,fetch(`${this.Se()}/api/v1/queue/${this.ce.le}/clear`,{method:"PUT",headers:this.Ie()}).then(e=>{e.ok&&(console.log("Queue cleared"),this.X.se.style.width="0%",this.X.de.src="")})},_e:function(){var e=this.Se(),t=(JSON.parse(this.X.W.value),this.xe());this.X.ne.disabled=!0,fetch(`${e}/api/v1/queue/${this.ce.le}/enqueue_batch`,{method:"POST",headers:this.Ie(),body:JSON.stringify(t)}).then(e=>{if(e.ok)return this.X.cancel.disabled=!1,this.X.clear.disabled=!1,this.X.ne.disabled=!1,e.json();this.ye(e.statusText),this.X.ne.disabled=!1}).then(e=>{console.log(e)}).catch(e=>{this.ye(e),this.X.ne.disabled=!1})},Ne:function(){var t=document.getElementsByClassName("selected");for(let e=0;e<t.length;e++)t[e].classList.remove("selected")},we:function(){let a=this.Se();fetch(a+"/api/v1/images/",{credentials:"include"}).then(e=>{if(e.ok)return e.json()}).then(s=>{this.X.ae.innerHTML="";for(let i=0;i<s.items.length;i++){var n=document.createElement("div");n.classList.add("gallery-image-container"),this.X.ae.appendChild(n);let t=s.items[i],e=document.createElement("img");e.src=a+"/"+t.thumbnail_url,e.classList.add("gallery-image"),e.onclick=()=>{this.Ne(),this.u&&this.u.image_name==t.image_name?this.u=null:(this.X.de.src=a+"/"+t.image_url,this.X.de.style.display="block",e.parentElement.classList.add("selected"),this.u=t),fetch(`${a}/api/v1/images/i/${t.image_name}/metadata`,{credentials:"include"}).then(e=>{if(e.ok)return e.json()}).then(i=>{var e=document.getElementById("metadata-table");e.innerHTML="";for(let t in i){var s=document.createElement("tr"),n=document.createElement("td");if(this.ce.hasOwnProperty(t)){var o=document.createElement("button");o.innerHTML="Load";let e=this.X[t];o.onclick=()=>{e.value=i[t],this.ve({id:t,value:i[t]})},n.appendChild(o)}s.appendChild(n),(n=document.createElement("td")).innerHTML=t,s.appendChild(n),(n=document.createElement("td")).innerHTML=JSON.stringify(i[t]),s.appendChild(n),e.appendChild(s)}}).catch(e=>{this.ye(e)})},n.appendChild(e);var o=document.createElement("div"),n=(o.classList.add("image-button-container"),n.appendChild(o),document.createElement("button")),d=(n.classList.add("delete-button"),n.innerHTML="Delete",n.onclick=()=>{fetch(a+"/api/v1/images/i/"+t.image_name,{method:"DELETE",headers:this.Ie()}).then(e=>{e.ok&&(this.we(),-1<this.X.de.src.indexOf(t.image_url))&&(this.X.de.src="",setTimeout(()=>{var e=this.X.ae.firstChild.firstChild;output.src=e.src.replace("thumbnail","full")},1e3))})},document.createElement("a"));d.href=a+"/"+t.image_url,d.target="_blank",d.innerHTML="Full Image",d.classList.add("full-image-button"),o.appendChild(d),o.appendChild(n),0==i&&-1<this.X.de.src.indexOf(window.location.href)&&(this.X.de.src=a+"/"+t.image_url)}}).catch(e=>{this.ye(e)})},qe:function(){let t=this.Se();fetch(t+"/api/v1/models/",{credentials:"include"}).then(e=>{if(e.ok)return e.json()}).then(e=>{this.X.W.innerHTML="",e.models.forEach(e=>{var t;"main"==e.$e&&((t=document.createElement("option")).value=JSON.stringify(e),t.innerHTML=e.Me,this.X.W.appendChild(t),this.fe("model")==JSON.stringify(e))&&(this.X.W.value=JSON.stringify(e))}),this.De(t)}).catch(e=>{this.ye(e)})},De:function(t){var e=(e=t.replace("http","ws")).replace("https","wss");this.t=io(e,{path:"/ws/socket.io",Ee:["websocket"]}),this.t.on("connect",()=>{console.log("Connected to server"),this.t.emit("subscribe_queue",{le:this.ce.le})}),this.t.on("generator_progress",e=>{this.h=e.progress_image;var t=e.step,i=e.total_steps;this.i=e.queue_item_id,this.X.se.style.width=Math.floor(t/i*100)+"%",this.X.se.style.border="1px solid var(--ok-graphical-fg)",this.X.cancel.disabled=!1,this.X.clear.disabled=!1,this.l=Math.floor(t/i*100),console.log("generator_progress",e.step),this.u||(this.X.de.src=this.h.dataURL,this.X.de.style.display="block")}),this.t.on("batch_enqueued",e=>{console.log("batch_enqueued",e)}),this.t.on("queue_item_status_changed",e=>{console.log("queue_item_status_changed",e);var e=e.queue_status.pending,t=document.getElementById("pending-count"),i=document.getElementById("pending");0<e?(this.X.cancel.disabled=!1,this.X.clear.disabled=!1,t.style.backgroundColor="var(--warning-color)",t.style.color="black"):(t.style.backgroundColor="var(--surface-color-1)",t.style.color="var(--text-color-1)",this.X.cancel.disabled=!0,this.X.clear.disabled=!0),i.innerHTML=e}),this.t.on("invocation_started",e=>{e=parseInt(e.node.seed);this.X.cancel.disabled=!1,e&&this.X.random.checked&&(this.X.seed.value=e,this.ve({id:"seed",value:e}))}),this.t.on("invocation_complete",e=>{this.o=e.result,this.o.g&&(console.log("invocation_complete",e),this.X.se.style.width="100%",this.u=null,e=t+"/api/v1/images/i/"+this.o.g.image_name+"/full",this.X.de.src=e,this.X.de.style.display="block",this.we(),setTimeout(()=>{this.X.se.style.width="0%"},2500))}),this.t.on("invocation_error",e=>{console.log("invocation_error",e),this.ye(e.error_type)})},xe:function(){var e=[parseInt(this.ce.seed)];if("true"==this.ce.random)for(var e=[],t=0;t<this.ce.ie;t++){var i=Math.floor(1e9*Math.random());e.push(i)}else this.X.ie.value=1;this.ce.Y;var s=JSON.parse(this.X.W.value);return{le:this.ce.le,Je:{data:[[{Pe:"noise",ze:"seed",items:e},{Pe:"core_metadata",ze:"seed",items:e}],[{Pe:"positive_conditioning",ze:"prompt",items:[this.ce.Y]},{Pe:"core_metadata",ze:"positive_prompt",items:[this.ce.Y]}]],Be:{id:"text_to_image_graph",Ge:{Le:{id:"main_model_loader",Ue:!0,Ae:!0,re:{Me:s.Me,Ce:s.Ce,$e:s.$e},type:"main_model_loader"},Fe:{id:"clip_skip",Ue:!0,Ae:!0,He:0,type:"clip_skip"},Ke:{id:"positive_conditioning",Ue:!0,Ae:!0,prompt:this.ce.Y,type:"compel"},Qe:{id:"negative_conditioning",Ue:!0,Ae:!0,prompt:this.ce.Z,type:"compel"},Re:{id:"noise",Ue:!0,Ae:!0,width:this.ce.width,height:this.ce.height,seed:parseInt(this.ce.seed),Ve:!0,type:"noise"},je:{id:"denoise_latents",Ue:!0,Ae:!0,ee:this.ce.ee,te:this.ce.te,Xe:0,We:1,oe:this.ce.oe,Ye:0,type:"denoise_latents"},Ze:{id:"latents_to_image",Ue:!0,Ae:!1,et:!1,tt:!0,type:"l2i"},it:{id:"core_metadata",Ue:!1,Ae:!0,st:"txt2img",Z:this.ce.Z,width:this.ce.width,height:this.ce.height,nt:"cpu",te:this.ce.te,Ye:0,ee:this.ce.ee,oe:this.ce.oe,Fe:0,re:{Me:s.Me,Ce:s.Ce,$e:s.$e},type:"core_metadata"},ot:{id:"linear_ui_output",Ue:!1,Ae:!1,type:"linear_ui_output"}},dt:[{source:{ht:"main_model_loader",ct:"unet"},destination:{ht:"denoise_latents",ct:"unet"}},{source:{ht:"main_model_loader",ct:"clip"},destination:{ht:"clip_skip",ct:"clip"}},{source:{ht:"clip_skip",ct:"clip"},destination:{ht:"positive_conditioning",ct:"clip"}},{source:{ht:"clip_skip",ct:"clip"},destination:{ht:"negative_conditioning",ct:"clip"}},{source:{ht:"positive_conditioning",ct:"conditioning"},destination:{ht:"denoise_latents",ct:"positive_conditioning"}},{source:{ht:"negative_conditioning",ct:"conditioning"},destination:{ht:"denoise_latents",ct:"negative_conditioning"}},{source:{ht:"noise",ct:"noise"},destination:{ht:"denoise_latents",ct:"noise"}},{source:{ht:"denoise_latents",ct:"latents"},destination:{ht:"latents_to_image",ct:"latents"}},{source:{ht:"core_metadata",ct:"metadata"},destination:{ht:"latents_to_image",ct:"metadata"}},{source:{ht:"main_model_loader",ct:"vae"},destination:{ht:"latents_to_image",ct:"vae"}},{source:{ht:"latents_to_image",ct:"image"},destination:{ht:"linear_ui_output",ct:"image"}}]},lt:1}}}};GOINVOKE.init();
